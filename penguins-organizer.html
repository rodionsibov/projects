<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Penguins Organizer (Fetch API Sandbox)</title>

    <style>

      
    </style>

  </head>
  <body>
    
    <input id="addItem" autofocus>

    <h1>Users</h1>
    <div id="users"> </div> 

    <h1>Todos</h1>
    <div id="todos"> </div> 
    


    <script>


      const urlTodos = "https://jsonplaceholder.typicode.com/todos"
      const urlUsers = "https://jsonplaceholder.typicode.com/users"

      model = {
	  items: [],
	  todos: []
      }

      view = {
	  render() {
//	      document.querySelector("#users").innerHTML = "";
	      
	      const users = document.querySelector("#users");
	      users.innerHTML = model.items.map(item => {
			  return `
<div id="${item.id}" onclick="view.showTodos(${item.id})">${item.text}</div>
`;
		  
	      }).join("");
	      
	      
	  },

	  showTodos(userId) {
	      const todos = document.querySelector("#todos");
	      todos.innerHTML = model.todos
		  .filter(el => el === userId)
		  .map(item => {
		  return `
<div>${item.text}</div>
`;
	      }).join("");

	  },
	  
	  addItem(e) {
	      if (e.code === "Enter") {
		  const input = document.querySelector("#addItem");
		  if (input.value !== "") {
		      controller.addItem(input.value);
		      return false;
		  }
	      }
	  }

      }

      controller = {
	  state: {
	      
	  },
	  
	  init() {
	      view.render();
	      this.getUsers();
	      this.getTodos();
	  },

	  addItem(item, id) {
	      const listItem = {text: item, completed: false, id: id};
	      model.items.unshift(listItem);
	      document.querySelector("#addItem").value = "";
	      view.render();
	  },

	  completeItem(itemIndex) {
	      model.items[itemIndex].completed = !model.items[itemIndex].completed;
	      view.render();
	  },

	  deleteItem(itemIndex) {
	      model.items.splice(itemIndex, 1);
	      view.render();
	  },

	  async getUsers() {
	      const data = await (await fetch(urlUsers)).json();
	      data.forEach(el => this.addItem(el.name, el.id));
	  },
	  
	  async getTodos() {
	      const data = await (await fetch(urlTodos)).json();
	      data.forEach(el => this.addTodos(el.title, el.completed, el.userId));

	  },

	  addTodos(item, completed, userId) {
	      const listItem = {text: item, completed: completed, userId: userId};
	      model.todos.unshift(listItem);
	      view.render();
	  }
      }


      
      // Event Display 
      addEventListener('DOMContentLoaded', () => {
	  controller.init();
      })

      document.querySelector("#addItem").addEventListener("keypress", (e) => {
	  view.addItem(e);
      })
      
    </script>
      </body>
</html>
